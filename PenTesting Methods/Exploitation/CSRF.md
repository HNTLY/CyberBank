# CSRF (Cross-Site Request Forgery)
## What are CSRF tokens?
Unique and unpredictable value generated server side and transmitted to client
When a request is made, the server valiadates the request by checking the token and rejects the request if it's invalid/missing

## How are the tokens created?
CSRF tokens should contain significant entropy (randomness) and be unpredictable.
A pseudo-random number generator (PRNG) should be used, making use of the timestamp and a static value

## Token validation
CSRF tokens are stored server-side within the users session
When a request is sent, the application verifies the users token against the servers token
An incorrect token or missing token results in a rejected request

## CSRF attack
CSRF allows an attacker to get a victim to perform an action they didn't intend, such as sending a manipulated link changing their email/password

## CSRF attack conditions
Three key conditions must be in place for this attack to take place:

1. A relevant action:
    * An action for the attacker to manipulate such as: modifying user permissions or modifying user details etc
2. Cookie-based session handling:
    * The application relies solely on session cookies for user identifcation when making requests
    * This attack requires multiple HTTP requests and multiple validation methods could cause issues
3. No unpredictable request parameters:
   * The relevant action request must not contain any other parameteres that the attacker cannot determine/manipulate
   * E.g Requiring the user to enter the current password when changing to a new password

## Using Burp to test for a CSRF vulnerability
1. Ensure you're authenticated to the web app e.g by logging in
2. Access the page you're testing e.g Account details
3. Alter the value e.g Change email
4. Capture the alter request in Burp Suite
5a. Burp Suite PRO: right click --> Engagement tools --> Generate CSRF PoC
5b. Burp Suite COMMUNITY: See how to generate your own CSRF PoC below 
6. Edit data e.g email
7. Save as `.html`
8. Turn off proxy and open html in same browser (to stay logged in)
9. Execute request in browser if needed and identify if data has been altered in account settings

### Burp Suite Community CSRF PoC
The CSRF PoC is simply a HTML form
It is made up of inpu field names which we can gather through inspect element or the Burp request capture
Change the vaues inside the fields and ensure `<form action="https://TARGET_SERVER.com/settings.php" method="POST">` so it navigates to the correct page
Save text as `.html`
Open with same browser used to login initially (to stay logged in)

Example PoC:

![CSRF_PoC](https://github.com/HNTLY/CyberBank/blob/master/Images/BurpCSRF_PoC.png)

### Burp Suite Extender Plugin

[CSRF POC Creator Github](https://github.com/rammarj/csrf-poc-creator)

Burp --> Extender --> Add --> Select .jar --> Next --> Close
